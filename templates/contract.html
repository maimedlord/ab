{% extends "base.html" %}
{% block title %}<title>MARKET</title>{% endblock %}
{% block css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/contract.css') }}">{% endblock %}
{% block body %}
    {{ data_obj['message'] }}
    <div>
        {% if contract_obj['phase'] == "creation" %}{# PHASE: CREATION #}
            <form id="set_open_form" method="post" name="set_open">
                <input id="s_o_f_open" name="s_o_f_open" type="hidden" value="true">
                set contract to open cuz you paid and stuff: <button type="submit">submit</button>
            </form>
        {% endif %}{# PHASE: CREATION #}
        {% if contract_obj['phase'] == "open" %}{# PHASE: OPEN #}
            contract is phase: "open"<p></p>
            {% if (current_user.id_object != contract_obj['owner']) and not data_obj['bhunter_offer'] %}{# show for anyone that's NOT the owner and has NOT offered on the contract yet #}
                make an offer on this contract:<p></p>
                <form id="make_offer_form" method="post" name="make_offer_form">
                    For what amount will you take on this contract? <input id="m_o_f_offer" min="{{ contract_obj['bounty'] }}" name="m_o_f_offer" placeholder="$0.00" step="0.01" required type="number"><p></p>
                    <button type="submit">submit</button>
                </form>
            {% elif data_obj['bhunter_offer'] %}{# show for bhunter that's already offered on contract #}
                Your existing offer on this contract:<p></p>
                offer: {{ data_obj['bhunter_offer']['offer'] }}
                time: {{ data_obj['bhunter_offer']['time'] }}
            {% else %}{# show for the contract owner... maybe add another elif here? #}
                {% for party in contract_obj['iparties'] %}
                    <div id="div_i_party">
                        interested party:<p></p>
                        <a href="{{ url_for('view_user', userid=party['bhunter']) }}">bounty hunter:    {{ party['bhunter'] }}</a><p></p>
                        offer:    <b>$ {{ party['offer'] }}</b><p></p>
                        time:    {{ party['time'] }}<p></p>
                        *** put here some type of JavaScript popup box that when submitted and upon successfully moving contract to "inprogress" then moves user to the contract page again, but this time the contract page will show for phase of inprogress ***<p></p>
                        <form id="accept_offer" method="post" name="accept_offer">
                            <input id="bhunterid" name="bhunterid" type="hidden" value="{{ party['bhunter'] }}">
                            <input id="bhunteroffer" name="bhunteroffer" type="hidden" value="{{ party['offer'] }}">
                            accept this offer?    <button type="submit">submit acceptance</button>
                        </form>
                    </div>
                {% endfor %}
            {% endif %}
        {% endif %}{# PHASE: OPEN #}
        {% if contract_obj['phase'] == "inprogress" %}{# PHASE: INPROGRESS #}
{#            <a href="{{ url_for('set_disputed', contractid=contract_obj['_id']) }}">link: set contract as disputed</a><p></p>#}
            bounty hunter: {{ contract_obj['bhunter'] }}<p></p>
            chat goes here...<p></p>
            <div id="chat_main">
                {% if contract_obj['chat']|length > 0 %}
                    {% for chat in contract_obj['chat'] %}
                        <div class="chat_row">
                            user: {{ chat['user'] }}  //  mood: {{ chat['mood'] }}  // time: {{ chat['time'] }}<p></p>
                            message: {{ chat['message'] }}<p></p>
                        </div>
                    {% endfor %}
                {% endif %}
                <div id="chat_send">
                    chat send input and button...
                    <form id="chat_send" method="post" name="chat_send">
                        <input id="c_s_f_message" name="c_s_f_message" placeholder="your message here..." required type="text">
                        <input id="c_s_f_mood" name="c_s_f_mood" placeholder="your mood here..." type="text"><p></p>
                        send this chat?    <button type="submit">submit chat</button>
                    </form>
                </div>
            </div>
        {% endif %}{# PHASE: INPROGRESS #}
        {% if contract_obj['phase'] == "stalled" %}{# PHASE: STALLED #}
        {% endif %}{# PHASE: STALLED #}
{#        other phases ...#}
        <p></p>
        <b>phase: {{ contract_obj['phase'] }}</b><p></p>
        {% if contract_obj['owner'] == current_user.id_object %}
            owner: you<p></p>
        {% else %}
            owner: {{ contract_obj['owner'] }}<p></p>
        {% endif %}
        bounty: {{ contract_obj['bounty'] }}<p></p>
        level of study: {{ contract_obj['lostudy'] }}<p></p>
        subject: {{ contract_obj['subject'] }}<p></p>
        specialization: {{ contract_obj['specialization'] }}<p></p>
        sample: {{ contract_obj['sample'] }}<p></p>
    </div>
{% endblock %}